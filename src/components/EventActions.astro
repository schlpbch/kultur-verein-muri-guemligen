---
import { Button } from '@components/ui/button'
import type { EventData } from 'types'

interface Props {
  event: {
    data: EventData
  }
}
const { event } = Astro.props

const currentUrl = encodeURI('https://kulturverein-muri.ch/')

const createMailLink = (event: { data: EventData }) => {
  const title = encodeURIComponent(event.data.title)
  const subject = encodeURIComponent('Einladung zu ') + title
  const url = currentUrl + '#' + encodeURIComponent(title)

  const body =
    'Hallo!%0D%0A%0D%0AIch möchte dich zu folgender Veranstaltung vom Kulturverein Muri Gümligen einladen:' +
    '%0D%0A%0D%0A' +
    encodeURIComponent(url) +
    '%0D%0A%0D%0A' +
    'Viele Grüsse'

  return `mailto:?subject=${subject}&body=${body}`
}

const createWhatsAppLink = (event: { data: EventData }) => {
  const title = encodeURI(event.data.title)
  const text = encodeURI(
    'Interessanter Event vom Kulturverein Muri Gümligen: \n',
  )
  const url = currentUrl + encodeURIComponent('#') + encodeURIComponent(title)

  return `https://wa.me/?text=${text}+${url}`
}

const today = new Date()
---

<div class="flex w-full items-center justify-between">
  <div class="flex gap-2">
    {
      event.data.date > today && (
        <a href={createMailLink(event)}>
          <Button variant="ghost" size="icon" aria-label="Teilen per E-Mail">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <rect x="3" y="5" width="18" height="14" rx="2" />
              <polyline points="3 7 12 13 21 7" />
            </svg>
          </Button>
        </a>
      )
    }
    {
      event.data.date > today && (
        <a href={createWhatsAppLink(event)}>
          <Button variant="ghost" size="icon" aria-label="Teilen per WhatsApp">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M3 21l1.65 -3.8a9 9 0 1 1 3.4 2.9l-5.05 .9" />
              <path d="M9 10a0.5 .5 0 0 0 1 0v-1a0.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a0.5 .5 0 0 0 0 -1h-1a0.5 .5 0 0 0 0 1" />
            </svg>
          </Button>
        </a>
      )
    }
  </div>
  {
    event.data.date > today && event.data.reservationURL && (
      <a
        href={event.data.reservationURL}
        target="_blank"
        rel="noopener noreferrer"
      >
        <Button
          variant="outline"
          className="h-7 rounded-full bg-transparent px-3 text-sm transition-all duration-300 hover:bg-yellow-400/60 hover:shadow-[inset_0_0_15px_rgba(250,204,21,0.6)] hover:border-yellow-400  text-black "
        >
          Buchen
        </Button>
      </a>
    )
  }
</div>
